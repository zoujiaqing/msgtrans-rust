/// è°ƒè¯•QUICäº‹ä»¶æµé—®é¢˜
/// 
/// æµ‹è¯•QUICé€‚é…å™¨çš„äº‹ä»¶æµæ˜¯å¦æ­£å¸¸å·¥ä½œ

use msgtrans::adapters::quic::{QuicAdapter, QuicServer};
use msgtrans::protocol::{QuicServerConfig, QuicClientConfig};
use std::net::SocketAddr;\nuse tokio::time::{sleep, Duration};\n\n#[tokio::main]\nasync fn main() -> Result<(), Box<dyn std::error::Error>> {\n    tracing_subscriber::fmt()\n        .with_max_level(tracing::Level::DEBUG)\n        .init();\n    \n    println!(\"ğŸ” è°ƒè¯•QUICäº‹ä»¶æµé—®é¢˜\");\n    \n    // 1. åˆ›å»ºQUICæœåŠ¡å™¨\n    let mut server = QuicServer::builder()\n        .bind_address(\"127.0.0.1:12346\".parse()?)\n        .config(QuicServerConfig::default())\n        .build()\n        .await?;\n    \n    println!(\"âœ… QUICæœåŠ¡å™¨åˆ›å»ºæˆåŠŸ\");\n    \n    // 2. åœ¨åå°å¯åŠ¨æœåŠ¡å™¨æ¥å—è¿æ¥\n    let server_task = tokio::spawn(async move {\n        println!(\"ğŸ“¡ ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...\");\n        match server.accept().await {\n            Ok(adapter) => {\n                println!(\"âœ… æœåŠ¡å™¨æ¥å—è¿æ¥æˆåŠŸ\");\n                \n                // æµ‹è¯•subscribe_eventsæ–¹æ³•\n                println!(\"ğŸ” æµ‹è¯•subscribe_eventsæ–¹æ³•...\");\n                let mut receiver = adapter.subscribe_events();\n                println!(\"âœ… subscribe_eventsè°ƒç”¨æˆåŠŸ\");\n                \n                // å°è¯•æ¥æ”¶äº‹ä»¶\n                println!(\"ğŸ“¡ ç­‰å¾…äº‹ä»¶...\");\n                match tokio::time::timeout(Duration::from_secs(5), receiver.recv()).await {\n                    Ok(Ok(event)) => {\n                        println!(\"ğŸ“¥ æ”¶åˆ°äº‹ä»¶: {:?}\", event);\n                    }\n                    Ok(Err(e)) => {\n                        println!(\"âŒ æ¥æ”¶äº‹ä»¶é”™è¯¯: {:?}\", e);\n                    }\n                    Err(_) => {\n                        println!(\"â° ç­‰å¾…äº‹ä»¶è¶…æ—¶\");\n                    }\n                }\n            }\n            Err(e) => {\n                println!(\"âŒ æœåŠ¡å™¨æ¥å—è¿æ¥å¤±è´¥: {:?}\", e);\n            }\n        }\n    });\n    \n    // 3. ç­‰å¾…ä¸€ä¸‹è®©æœåŠ¡å™¨å¯åŠ¨\n    sleep(Duration::from_millis(100)).await;\n    \n    // 4. åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥\n    println!(\"ğŸ”Œ åˆ›å»ºå®¢æˆ·ç«¯è¿æ¥...\");\n    let client = QuicAdapter::connect(\"127.0.0.1:12346\".parse()?, QuicClientConfig::default()).await?;\n    println!(\"âœ… å®¢æˆ·ç«¯è¿æ¥æˆåŠŸ\");\n    \n    // 5. ç­‰å¾…æœåŠ¡å™¨ä»»åŠ¡å®Œæˆ\n    server_task.await?;\n    \n    println!(\"ğŸ‰ è°ƒè¯•æµ‹è¯•å®Œæˆ\");\n    Ok(())\n} 