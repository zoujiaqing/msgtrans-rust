/// ç®€å•çš„QUICè°ƒè¯•æµ‹è¯•
/// 
/// æµ‹è¯•QUICé€‚é…å™¨çš„äº‹ä»¶æµæ˜¯å¦æ­£å¸¸å·¥ä½œ

use msgtrans::{\n    transport::{TransportServerBuilder, TransportClientBuilder}, \n    protocol::{QuicServerConfig, QuicClientConfig},\n};\nuse std::time::Duration;\nuse tokio::time::sleep;\nuse futures_util::StreamExt;\n\n#[tokio::main]\nasync fn main() -> Result<(), Box<dyn std::error::Error>> {\n    tracing_subscriber::fmt()\n        .with_max_level(tracing::Level::DEBUG)\n        .init();\n    \n    println!(\"ğŸ” ç®€å•QUICè°ƒè¯•æµ‹è¯•\");\n    \n    // 1. åˆ›å»ºQUICæœåŠ¡å™¨\n    let quic_server_config = QuicServerConfig {\n        bind_address: \"127.0.0.1:12347\".parse().unwrap(),\n        ..Default::default()\n    };\n    \n    let server = TransportServerBuilder::new()\n        .with_protocol(quic_server_config)\n        .build()\n        .await?;\n    \n    println!(\"âœ… QUICæœåŠ¡å™¨åˆ›å»ºæˆåŠŸ\");\n    \n    // 2. å¯åŠ¨æœåŠ¡å™¨\n    let server_task = {\n        let server = server.clone();\n        tokio::spawn(async move {\n            if let Err(e) = server.serve().await {\n                eprintln!(\"âŒ æœåŠ¡å™¨é”™è¯¯: {:?}\", e);\n            }\n        })\n    };\n    \n    // 3. ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨\n    sleep(Duration::from_millis(100)).await;\n    \n    // 4. åˆ›å»ºå®¢æˆ·ç«¯\n    let quic_client_config = QuicClientConfig {\n        target_address: \"127.0.0.1:12347\".parse().unwrap(),\n        ..Default::default()\n    };\n    \n    let client = TransportClientBuilder::new()\n        .with_protocol(quic_client_config)\n        .build()\n        .await?;\n    \n    println!(\"âœ… å®¢æˆ·ç«¯åˆ›å»ºæˆåŠŸ\");\n    \n    // 5. è·å–æœåŠ¡å™¨äº‹ä»¶æµ\n    let mut server_events = server.events();\n    \n    // 6. ç›‘å¬æœåŠ¡å™¨äº‹ä»¶\n    println!(\"ğŸ“¡ ç›‘å¬æœåŠ¡å™¨äº‹ä»¶...\");\n    \n    let mut event_count = 0;\n    while let Ok(event_result) = tokio::time::timeout(Duration::from_secs(3), server_events.next()).await {\n        match event_result {\n            Ok(event) => {\n                println!(\"ğŸ“¥ æœåŠ¡å™¨äº‹ä»¶: {:?}\", event);\n                event_count += 1;\n                \n                if event_count >= 2 {\n                    break;\n                }\n            }\n            Err(e) => {\n                eprintln!(\"âŒ æœåŠ¡å™¨äº‹ä»¶é”™è¯¯: {:?}\", e);\n                break;\n            }\n        }\n    }\n    \n    println!(\"ğŸ‰ è°ƒè¯•æµ‹è¯•å®Œæˆï¼Œæ”¶åˆ° {} ä¸ªäº‹ä»¶\", event_count);\n    \n    // æ¸…ç†\n    server_task.abort();\n    \n    Ok(())\n} 